<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Song Shop Database</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="admin-container">
        <a href="/" class="back-btn">‚Üê Back to Home</a>
        
        <h1 class="admin-title">Database Admin Panel</h1>
        <p class="admin-subtitle">View all saved tracks, artists, and genres</p>

        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <div class="stat-label">Total Songs</div>
                <div class="stat-number" id="songCount">-</div>
            </div>
            <div class="stat-card stat-card-artists">
                <div class="stat-label">Total Artists</div>
                <div class="stat-number" id="artistCount">-</div>
            </div>
            <div class="stat-card stat-card-genres">
                <div class="stat-label">Total Genres</div>
                <div class="stat-number" id="genreCount">-</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('songs')">View Songs</button>
            <button class="tab-btn" onclick="switchTab('deleteArtist')">Delete by Artist</button>
            <button class="tab-btn" onclick="switchTab('messages')">Messages</button>
        </div>

        <!-- Tab 1: View Songs -->
        <div id="songs-tab" class="tab-content active">
            <div class="section-header">
                <h2>All Songs</h2>
                <button class="refresh-btn" onclick="loadData()">Refresh</button>
            </div>

            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Album</th>
                            <th>Title</th>
                            <th>Artist</th>
                            <th>Genre</th>
                            <th>Added</th>
                            <th>Spotify</th>
                        </tr>
                    </thead>
                    <tbody id="songsTable">
                        <tr><td colspan="6" class="no-data">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 2: Delete by Artist -->
        <div id="deleteArtist-tab" class="tab-content">
            <div class="section-header">
                <h2>Delete All Songs by Artist</h2>
            </div>

            <div class="delete-artist-form">
                <label for="artistSelect" class="form-label">Select Artist:</label>
                <select id="artistSelect" class="form-select">
                    <option value="">Loading artists...</option>
                </select>
                
                <div id="artistInfo" class="artist-info-box">
                    <p><strong>Songs by this artist:</strong> <span id="songCountByArtist">-</span></p>
                    <button onclick="deleteArtistSongs()" class="delete-btn">Delete All Songs</button>
                </div>
            </div>

            <div id="deleteMessage" class="delete-message">
            </div>

            <div class="delete-artist-form">
                <h3>Clean Up Duplicate Artists</h3>
                <p>Reassigns songs to a single artist record when duplicate artist names exist, then removes the extras.</p>
                <button onclick="mergeDuplicateArtists()" class="refresh-btn">Merge Duplicate Artists</button>
                <div id="dedupeMessage" class="delete-message"></div>
            </div>
        </div>

        <!-- Tab 3: Messages Management -->
        <div id="messages-tab" class="tab-content">
            <div class="section-header">
                <h2>Community Messages</h2>
                <button class="refresh-btn" onclick="loadMessages()">Refresh</button>
            </div>

            <div id="messages-list" class="messages-admin-list">
                <p class="loading-text">Loading messages...</p>
            </div>
        </div>

    <script>
        window.ADMIN_SPOTIFY_ID = "<%= process.env.ADMIN_SPOTIFY_ID || '' %>";
    </script>
    <script src="/admin-logic.js"></script>
    <script>
        // Load artists on page load
        let currentOffset = 0;
        loadArtists();
    </script>
</body>
</html>
